# Agentic Core Workflow
## Walkthrough
### Setup
- Create an [`.env` file](./.env) by following these steps:
    - Copy the provided [`sample_config.yaml`](./sample_config.yaml):
        - `cp sample_config.yaml config.yaml`
        - Fill in in the `aie_domain` field with the domain for the target AIE environment
        - Run the python script:
            - `chmod + ./create_env.py`
            - `./create_env.py`
- **[Optional]**:
    - For most of the helm charts below, there is a top-level option in the `values.yaml` called `certificatesPolicy` which can fix issues with AIE environments with self-signed certificates. You can turn it on after making sure the default `configMap` variable (`ezaf-root-ca`) matches the name of the `cert-manager` bundle with the value of `spec.sources.useDefaultCAs=true`:
        - `kubectl describe bundles`
- Install the following frameworks:
    - [NeMo Microservices Guardrails `v25.12.0`](https://github.com/ai-solution-eng/frameworks/tree/main/nemo-microservices/guardrails-only)
        - Make sure the namespace is `nemo-microservices` as it's expected in some of the guardrail configuration steps
    - [Arize Phoenix `v4.0.17`](https://github.com/ai-solution-eng/frameworks/tree/main/arize-phoenix)
        - Make sure the namespace is `phoenix` as it's expected in the `PHOENIX_COLLECTOR_ENDPOINT` variable in the [`.env` file](./.env)
        - Create and store the Arize Phoenix API Key in the `PHOENIX_API_KEY` variable in the [`.env` file](./.env):
            - Navigate to Arize Phoenix UI ([show in `PHOENIX_ISTIO_ENDPOINT`](./.env) or in the Arize Phoenix frameworks tab)
            - `Settings -> General -> System Keys -> Create new System Key`
    - [Minio `v5.4.0`](https://github.com/ai-solution-eng/frameworks/tree/main/minio)
        - Use the values `rootUser` and `rootPassword` to log into the Minio UI
        - In the left dashboard tav nagivate to `User -> Access Keys`
        - Select `Create access key` and note the `Access Key` and `Secret Key` which will be needed for the S3 MCP Server installation
- Install the following MCP Servers:
    - [EzPresto MCP Server](mcp-servers/ezpresto-server/)
    - [Filesystem MCP Server](mcp-servers/filesystem-server/)
        - It requires a variable called `volumeName` that can be acquired with the following command:
            - `kubectl get pvc shared-pvc -n ezprojects-system -o jsonpath='{ ..volumeName }'`
    - [S3 MCP Server](mcp-servers/s3-server/)
        - Use the `Access Key` and `Secret Key` from earlier in the values
- Install the following tools:
    - [MCP Inspector](tools/mcp-inspector/)
    - [Guardrail Model Controller](tools/controller/)
- [Follow the guardrail configuration setup](guardrails/README.md)
- After setting up the models, finish the Arize Phoenix configuration:
    - Navigate to the UI and then to `Settings -> Models -> Add Model -> Add model name` (models specified in the `NEMO_MAIN_MODEL_ID` and `NEMO_GUARDRAIL_MODEL_ID`)
- Set up the [sample data sources](./examples/data/)
    - In the AIE home page, navigate to `Data Engineering -> Data Sources -> Structured Data -> Add New Data Source`
    - Select `Hive -> Create Connection`
    - Use the following fields:
        - Name: `flightdb`
        - Hive Metastore: `discovery`
        - Data Dir: `file:/data/shared/foundational-workflows/agentic/examples/data/hive`
        - Hive Metastore Advanced Settings: `File Type`
        - File Type: `CSV`
    - Then select `Connect`
- Go to the [examples folder](./examples/) and run through the different agentic framework examples:
    - [Crewai](./examples/crewai/README.md)
    - [LangGraph](./examples/langgraph/README.md)
